<!DOCTYPE html>
<html>
  <head>
    <title>Device Properties Example</title>

    <script type="text/javascript" charset="utf-8" src="cordova-2.5.0.js"></script>
    <script type="text/javascript" charset="utf-8">

    // Wait for Cordova to load
    //
    /*document.addEventListener("deviceready", onDeviceReady, false);
    var count = 1;
    
    // Record audio
    function recordAudio() {
        var src = "/voice_new.amr";
        count++;
        var mediaRec = new Media(src, onSuccess, onError);

        // Record audio
        mediaRec.startRecord();

        // Stop recording after 10 sec
        var recTime = 0;
        var recInterval = setInterval(function() {
            recTime = recTime + 1;
            setAudioPosition(recTime + " sec");
            if (recTime >= 10) {
                clearInterval(recInterval);
                mediaRec.stopRecord();
            }
        }, 1000);
    }

    // Cordova is ready
    //
    function onDeviceReady() {
        recordAudio();
    }

    // onSuccess Callback
    //
    function onSuccess() {
        console.log("recordAudio():Audio Success");
    }

    // onError Callback 
    //
    function onError(error) {
        alert('code: '    + error.code    + '\n' + 
              'message: ' + error.message + '\n');
    }

    // Set audio position
    // 
    function setAudioPosition(position) {
        document.getElementById('audio_position').innerHTML = position;
    }*/
    
    // Declare global variables
var state = 0; // 0 record, 1 stop, 2 playback   
var src = "recording.amr"; // name of audio file
var mediaRec; // the object for recording and play sound
var directory; // holds a reference for directory reading
 
// Wait for PhoneGap to load
document.addEventListener("deviceready", onDeviceReady, false);
 
// PhoneGap is ready
function onDeviceReady() {
  window.requestFileSystem(LocalFileSystem.PERSISTENT, 0, onFileSytemSuccess, null);         
}
 
// For this simple example we'll use the same file
function onClick() {
  console.log("onClick() "+state);
  switch(state) {
    case 0: 
      startRecording(); 
      break;
    case 1: 
      stopRecording(); 
      break;
    default: 
      playRecording();
    }
  // Cycle back for another recording
  if( ++state > 2 ) {
    state =0;
  }
}
 
function startRecording() {
  console.log("startRecording()"); 
  // Create your Media object
  mediaRec = new Media(directory.fullPath+"/"+src,
  // Success callback
  function() {
    console.log("mediaRec -> success");
    document.getElementById("btnSound").value = "recording";
  },
  // Error callback
  function(err) {
    console.log("mediaRec -> error: "+ err.code);
    document.getElementById("btnSound").value = "error recording";
  });
  // Record audio
  mediaRec.startRecord();
}
 
function stopRecording() {
   console.log("stopRecording()");
   mediaRec.stopRecord();
   document.getElementById("btnSound").value = "start recording";
}
 
function playRecording() {
  console.log("playRecording()");
  mediaRec.play();
  document.getElementById("btnSound").value = "playing";
}
 
function onFileSytemSuccess(fileSystem) {
  // Get the data directory, creating it if it doesn't exist.
  fileSystem.root.getDirectory("",{create:true},onDirectory,onError);
  // Create the lock file, if and only if it doesn't exist.	
  fileSystem.root.getFile(src, {create: true, exclusive: false}, onFileEntry, onError);  
}
 
function onFileEntry(fileEntry) {
  console.log("onFileEntry()");
}
 
function onDirectory(d) {
  console.log("onDirectory()");
  directory = d;
  var reader = d.createReader();
  reader.readEntries(onDirectoryRead,onError);
}
 
// Helpful if you want to see if a recording exists 
function onDirectoryRead(entries) {
  //console.log("The dir has "+entries.length+" entries.");
  // Scan for audio src
  for (var i=0; i<entries.length; i++) {
    //console.log(entries[i].name+' dir? '+entries[i].isDirectory);
    if(entries[i].name == src) {
      console.log("file found");
     }
  }
}
 
function onSuccess() {
  console.log("onSuccess()");
}
 
function onError(error) {
  alert('onError(): '    + error.code    + '\n' + 
  'message: ' + error.message + '\n');
}

    </script>
  </head>
  <body>
    <p id="media">Recording audio...</p>
    <p id="audio_position"></p>
    <button id="btnSound" onclick="onClick();">click to record (play/stop)</button>
  </body>
</html>
